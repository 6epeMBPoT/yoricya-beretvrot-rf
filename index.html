<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<body>

<style>
    html { font-family: monospace; }
    table { border-collapse: collapse; }
    .center { height: 100%; width: 100%; display: flex; position: fixed; align-items: center; justify-content: center; }

    body {
        color:#5D8D9B;
        background: #1C2B36;
    }

    a {
        color: #6A9FB5
    }

    a:visited {
        color: #6A9FB5
    }
</style>

<div class="center">
    <div>
        <h1><a href="https://yoricya.ru">–ô–æ—Ä–∏—Å—è</a>, <label id="metrovOtVas">300 –º–µ—Ç—Ä–æ–≤ –æ—Ç –≤–∞—Å.</label></h1>
        <h2>–ö—É–ø–ª—é —Å—ã—Ä–∞ üßÄ,<br> –í–æ–∑—å–º—É –≤ —Ä–æ—Ç.</h2>
    </div>
</div>

<script>
    let metrovOtVas = document.getElementById("metrovOtVas")

    async function getLocation(){
        let dist = 300

        let t = localStorage.getItem("t")
        if(t && (Date.now() - t < 10 * 60 * 1000)) // Get Distance from cache
            dist = localStorage.getItem("dist")
        else try { // Get Distance from API
            let resp = await (await fetch('https://ipinfo.io/json')).json()
            const [lat, lon] = resp.loc.split(',');
            const [targetLat, targetLon] = [63.7935, 74.5257]

            // Calc distance
            dist = calculateDistance(lat, lon, targetLat, targetLon).toFixed(3) * 1000;

            // Caching
            localStorage.setItem("t", Date.now())
            localStorage.setItem("dist", dist)
        } catch (e){
            console.error("Ooops, error: ", e)
        }

        let decl
        if(dist > 1000)
            decl = getDeclension(Math.trunc(dist / 1000), "–∫–∏–ª–æ–º–µ—Ç—Ä")
        else
            decl = getDeclension(Math.trunc(dist), "–º–µ—Ç—Ä")

        metrovOtVas.innerText = decl+" –æ—Ç –≤–∞—Å."
    }

    function calculateDistance(lat1, lon1, lat2, lon2) {
        const R = 6378; // –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –∫–∏–ª–æ–º–µ—Ç—Ä–∞—Ö
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLon / 2) * Math.sin(dLon / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return R * c;
    }


    const pluralRules = new Intl.PluralRules('ru');
    const declensions = {
        "–º–µ—Ç—Ä": ["–º–µ—Ç—Ä", "–º–µ—Ç—Ä–∞", "–º–µ—Ç—Ä–æ–≤"],
        "–∫–∏–ª–æ–º–µ—Ç—Ä": ["–∫–∏–ª–æ–º–µ—Ç—Ä", "–∫–∏–ª–æ–º–µ—Ç—Ä–∞", "–∫–∏–ª–æ–º–µ—Ç—Ä–æ–≤"],
    };

    function getDeclension(number, word) {
        // –ü–æ–ª—É—á–∞–µ–º —Ñ–æ—Ä–º—É —á–∏—Å–ª–∞
        const form = pluralRules.select(number);

        // –ü–æ–ª—É—á–∞–µ–º —Å–∫–ª–æ–Ω–µ–Ω–∏—è –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞
        const titles = declensions[word];

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–∫–ª–æ–Ω–µ–Ω–∏—è –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Å–ª–æ–≤–∞
        if (!titles) {
            throw new Error("–î–ª—è —ç—Ç–æ–≥–æ —Å–ª–æ–≤–∞ —Å–∫–ª–æ–Ω–µ–Ω–∏—è –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã.");
        }

        // –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ñ–æ—Ä–º—ã —á–∏—Å–ª–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω—É–∂–Ω—É—é —Ñ–æ—Ä–º—É —Å–ª–æ–≤–∞
        if (form === 'one') {
            return `${number} ${titles[0]}`;  // –¥–ª—è 1, 21, 31 –∏ —Ç. –¥.
        } else if (form === 'few') {
            return `${number} ${titles[1]}`;  // –¥–ª—è 2-4, 22-24, 32-34 –∏ —Ç. –¥.
        } else {
            return `${number} ${titles[2]}`;  // –¥–ª—è 5, 6, 7, 8, 9 –∏ —Ç. –¥.
        }
    }

    getLocation()
</script>

<style>
    @keyframes gradientSlide {
        0% {
            transform: translateX(calc(-10vw - 100%)) rotate(0deg) translateY(0);
        }
        50% {
            @media (min-width: 500px) {
                transform: translateX(50vw) rotate(90deg) translateY(30%);
            }

            @media (max-width: 499px) {
                transform: translateX(60vw) rotate(90deg);
            }
        }

        100% {
            transform: translateX(110vw) rotate(180deg) translateY(0);
        }
    }

    .gradient-disk {
        z-index: -1;
        position: fixed;
        width: 520px;
        height: 650px;
        top: 10%;
        border-radius: 50%;
        opacity: 0.1;
        background: radial-gradient(circle, #1C2B36, #243847, #314E5C, #5D8D9B);
        animation: gradientSlide 10s infinite linear;
    }
</style>
<div class="gradient-disk"></div>

</body>
</html>
